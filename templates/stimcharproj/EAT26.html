<!DOCTYPE html>
<html>
	<head>
		<link href="/static/style.css" rel="stylesheet">
		<title>Questionnaire 2</title>
		<center><h2 id='h2'>Questionnaire 2</h2></center>
	</head>

	<body>
	<p id='instr'>Please choose a response for each of the following statements.</p>

	<form id='form' method="POST">
		<table>
			{% for i in range(0,questions|length) %}
			<tr>
				<th align="left"></th>
				<th style="width:10%">{{ option1[i] }}</th>
				<th style="width:10%">{{ option2[i] }}</th>
				<th style="width:10%">{{ option3[i] }}</th>
				<th style="width:10%">{{ option4[i] }}</th>  	
				<th style="width:10%">{{ option5[i] }}</th>  	
				<th style="width:10%">{{ option6[i] }}</th>  		
			</tr>
			<tr>
				<th><p align="left" name={{"q"+(i+1)|string}} value={{questions[i]}}>{{ i+1 }}. {{ questions[i] }}</p></th>
				<input type="hidden" name={{"q"+(i+1)|string}} value="{{questions[i]}}">
				<th><input type="radio" name={{"a"+(i+1)|string}} value="{{option1[i]}}" required></th>
				<th><input type="radio" name={{"a"+(i+1)|string}} value="{{option2[i]}}" required></th>
				<th><input type="radio" name={{"a"+(i+1)|string}} value="{{option3[i]}}" required></th>
				<th><input type="radio" name={{"a"+(i+1)|string}} value="{{option4[i]}}" required></th>
				<th><input type="radio" name={{"a"+(i+1)|string}} value="{{option5[i]}}" required></th>
				<th><input type="radio" name={{"a"+(i+1)|string}} value="{{option5[i]}}" required></th>
			</tr> 
			{% endfor %}
		</table>

		<table>
			<tr>
				<th align="left"></th>
				<th style="width:30%">Yes</th>
				<th style="width:30%">No</th>
			</tr>
			<tr>
				<tr>
				<th><p align="left" name="q31" value='Lost 20 pounds or more in the last 6 months?'>31. Lost 20 pounds or more in the last 6 months?</p></th>
				<input type="hidden" name="q31" value='Lost 20 pounds or more in the last 6 months?'>
				<th><input type="radio" name="a31" value="Yes" required></th>
				<th><input type="radio" name="a31" value="No" required></th>
			</tr> 
		</table>
		
		<center><button type="button" onclick="getHungerRating()" style='font-family: "Arial";font-size: 30px;'>Submit</button></center>
	<br><br>
	<input type="hidden" id="hungerRatingResults" name="hungerRatingResults" value="">
	</form>

	<svg id="mySVG" style="display: none;"></svg>
	<canvas id="myCanvas" style="display: none;"></svg>

	<script src="{{ url_for('static', filename='components.js') }}"></script>
	<script src="{{ url_for('static', filename='run_ratingtask.js') }}"></script>
	
	<script>
		
		var svg = document.getElementById("mySVG");
		var allTrials = [];
		var currTrialN = 0;
		var currTrial = new trial({'question':'How hungry are you right now?'});
		allTrials.push(currTrial);
		var instructions;
		var scale;
		var tb1, tb2, tb3, tb4, tb5, tb6;
		var t1;

		function getHungerRating() {
			// hide the form
			document.getElementById('form').style.display="none";
			document.getElementById('h2').style.display="none";
			document.getElementById('instr').style.display="none";
			
			svg.style="padding: 0; margin: auto; display: block; position: absolute; top: 0; bottom: 0; left: 0; right: 0; width: 100%";
			var winWidth = window.innerWidth;
			var winHeight = window.innerHeight;
			canvas.width = winWidth;
			canvas.height = winHeight;
			var ctx = canvas.getContext('2d');
			
			instructionsText='Please rate your hunger. How hungry are you?'
			instructions = new textBox(instructions, instructionsText, 20, BLACK);
			instructions.showText(0, canvas.height/2 - 60);

			scale = new ratingScale(0,10,1,0.01,canvas.width/2,canvas.height/2, ["0", "", "", "", "", "5", "", "", "", "", "10"]);
			scale.drawRatingScale(canvas.width/2,canvas.height/2); // draws/redraws scale

			// 0 is the middle of the screen / the middle of the scale

			var tb1Text='Not at all'
			tb1 = new textBox(tb1, tb1Text, 20, BLACK);
			tb1.showText(0 - scale.ratingBarWidth/2, canvas.height/2 + 85);

			var tb2Text='A little'
			tb2 = new textBox(tb2, tb2Text, 20, BLACK);
			tb2.showText(0 - scale.ratingBarWidth/4, canvas.height/2 + 85);

			var tb3Text='Somewhat'
			tb3 = new textBox(tb3, tb3Text, 20, BLACK);
			tb3.showText(0, canvas.height/2 + 85);

			var tb4Text='Very'
			tb4 = new textBox(tb4, tb4Text, 20, BLACK);
			tb4.showText(0 + scale.ratingBarWidth/4, canvas.height/2 + 85);

			var tb5Text='Extremely'
			tb5 = new textBox(tb5, tb5Text, 20, BLACK);
			tb5.showText(0 + scale.ratingBarWidth/2, canvas.height/2 + 85);
			
			t1 = performance.now();
		}

		// overwrite the function getRating(evt) in components.js
		var waitingForHungerRsp = true;
		var getRating = function(evt) {
			if (!svg.contains(blankScreenCover)) { 
				if (waitingForHungerRsp) {
					var nRatingValues = (scale.max - scale.min)/scale.increment;
					var nScaleValues = scale.ratingBarWidth/scale.increment;
					var clickX = evt.clientX;

					// mouse listener is on the selector, not the bar itself
					// so mouse can actually be clicked on a location before the bar
					// this readjusts the location of the click so it can only be at the max or min
					if (clickX < scale.ratingBarX) {
						clickX = scale.ratingBarX
					} else if (clickX > scale.ratingBarX + scale.ratingBarWidth) {
						clickX = scale.ratingBarX + scale.ratingBarWidth;
					}

					var rating = clickX - scale.ratingBarX + scale.min;
					rating = rating / nScaleValues * nRatingValues;
					rating = rating/scale.increment;
					rating = Math.floor(rating);
					rating = rating*scale.increment;
					t2 = evt.timeStamp;
					allTrials[currTrialN].rating = rating; 
					allTrials[currTrialN].rt = t2 - t1; 
					instructions.removeText();
					scale.removeScale();

					tb1.removeText();
					tb2.removeText();
					tb3.removeText();
					tb4.removeText();
					tb5.removeText();

					var strExpResults = JSON.stringify(allTrials);
					document.getElementById('hungerRatingResults').value = strExpResults;
					document.getElementById('form').submit()
				} 
				else {
					if (!svg.contains(blankScreenCover)) { 
						t2_UNIX = Date.now();
						scale.recordRating(evt);
					}
				}
			}
		}
		</script>
	</body>
</html>
